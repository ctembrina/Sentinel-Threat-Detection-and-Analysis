# Sentinel Threat Detection and Analysis




<h2>Description</h2>
This project demonstrates the deployment of a cloud-based Security Operations Center (SOC) using Microsoft Azure Sentinel (SIEM) to detect and analyze intrusion attempts targeting a Windows Virtual Machine (VM). The architecture showcases how real-time telemetry and security logs are collected, analyzed, and visualized through an integrated cloud security pipeline.


<h2>Utilities Used</h2>

- <b>Microsoft Azure Portal – Cloud management and deployment interface</b> 
- <b>Microsoft Sentinel (SIEM) – Security Information and Event Management for detection and analysis</b>
- <b>Azure Log Analytics Workspace – Log collection and data correlation</b>
- <b>Azure Virtual Machine (Windows Server) – Host system for attack simulation</b>
- <b>Azure Network Security Group (NSG) – Network access control and traffic filtering</b>
- <b>Azure Virtual Network (VNet) – Network isolation and communication routing</b>
- <b>Azure Resource Group – Resource organization and lifecycle management</b>
- <b>Draw.io (diagrams.net) – Architecture diagram design and visualization</b>




<h2>Architecture Description:</h2>

<p align="left">
The lab environment is built within the Azure Cloud Platform, where a Resource Group hosts a Virtual Machine (VM) connected to a Virtual Network (VNet) and protected by a Network Security Group (NSG). The VM is intentionally exposed to the public internet to simulate real-world attack scenarios from external threat actors. Security and event data generated by the VM is ingested into the Log Analytics Workspace, where it is then forwarded to Microsoft Sentinel (SIEM) for advanced analysis and correlation. Sentinel workbooks and dashboards visualize detected activities, such as brute-force attempts, suspicious logins, and geographic attack mapping.

<p align="center"> 
  
<br/>
<img src="https://i.imgur.com/K979mXd.png"height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<h2>Key Components:</h2>

- <b>Azure Resource Group – Centralized container for managing cloud assets</b> 
- <b>Virtual Machine (VM) – Simulated endpoint targeted by attackers</b>
- <b>Network Security Group (NSG) – Defines inbound and outbound traffic rules</b>
- <b>Log Analytics Workspace – Collects and normalizes security logs</b>
- <b>Microsoft Sentinel (SIEM) – Performs detection, analysis, and visualization of attack data</b>
- <b>Attack Map Dashboard – Displays live intrusion attempts based on geolocation data</b>

<h2>Outcomes:</h2>

- <b>Successfully detected and visualized external brute-force and network intrusion attempts</b> 
- <b>Gained hands-on experience configuring Azure Sentinel, Log Analytics, and NSG rules</b>
- <b>Demonstrated understanding of SIEM operations, cloud security architecture, and incident analysis</b>
  
<h2>Lab:</h2>

- <b>Network Security Group (NSG) Exposure Configuration</b>

<p align="left"> 
In this stage of the project, I modified the Azure Network Security Group (NSG) to simulate a high-risk network exposure. I deleted the original RDP (3389) inbound rule and created a new rule named “Danger_AllowAnyCustomInbound”, configured to allow unrestricted inbound traffic from any source and any port.

This intentional misconfiguration was designed to mimic a real-world vulnerability, allowing potential external access to the virtual machine through the public internet. The objective was to test how Microsoft Sentinel and the Log Analytics Workspace detect, log, and visualize these suspicious or unauthorized connections in a Security Operations Center (SOC) environment.

By temporarily creating this rule, I was able to demonstrate how insecure configurations can be quickly identified through alerting and analytics tools within Azure’s security ecosystem.

<p align="center"> 

<img src="https://i.imgur.com/8yF0Bxz.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<img src="https://i.imgur.com/6y57hAZ.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<img src="https://i.imgur.com/U2NzW1j.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<img src="https://i.imgur.com/uPb6IRP.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />

- <b>Virtual Machine Configuration</b>

<p align="left"> 
Named the Azure Virtual Machine (CORP-CTNET-EAST-1), a honeypot, intentionally designed to attract cyber attackers. It mimics real targets, such as servers, applications, or networks, but is isolated and monitored to record attacker behavior, techniques, and tools.

The main purpose of a honeypot is to detect, study, and analyze malicious activity without risking real assets. Security teams use honeypots to gain insights into new attack patterns, improve intrusion detection systems, and strengthen overall defensive strategies.

<p align="center"> 
<img src="https://i.imgur.com/nNR0WH8.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<p align="left"> 
I tested connectivity to the virtual machine by connecting via RDP and then configured the firewall rules within the VM to allow the necessary traffic. (windows defender = off)
<p align="center"> 
<img src="https://i.imgur.com/Fxq2yRu.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<img src="https://i.imgur.com/5yL189C.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<p align="left"> 
To verify logging and detection, I attempted a failed login using a bogus username (employee) and then examined Windows Event Viewer. The Event Viewer contained the expected failed authentication entries (timestamps, source IP, and failure reason), confirming that local auditing captured unsuccessful logon attempts for monitoring and incident response validation.
<p align="center"> 
<img src="https://i.imgur.com/fgAMYGU.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<p align="left"> 
I then opened Windows Event Viewer and filtered the Security logs using Event ID 4625 as the search criterion, limiting the results to only failed logon events. This confirmed that unsuccessful login attempts were accurately recorded and traceable for audit and incident response purposes.
 - Source: Security (generated by the Local Security Authority Subsystem Service — LSASS)

Event ID: 4625

Category: Logon/Logoff

Meaning: An account failed to log on

Common reasons:

Wrong username or password

Disabled account

Locked-out account

Logon type not allowed (e.g., RDP disabled for that user)
<p align="center"> 
<img src="https://i.imgur.com/dkJc5xm.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<p align="left"> 
Limiting the results to only failed logon events. This confirmed that unsuccessful login attempts were accurately recorded and traceable for audit and incident response purposes.
<p align="center"> 
<img src="https://i.imgur.com/XYCV2WG.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />


<h2>Microsoft Sentinel:</h2>

- <b>Log Analytics Workspace</b>
<p align="left"> 
Log Analytics Workspace (LOGA-SOC-LAB-100) – Created and configured a centralized workspace in Azure to collect and analyze security event data from connected resources. Added Data Connectors such as Windows Security Events to capture logon activity and system events from virtual machines. Utilized Kusto Query Language (KQL) for event correlation, threat detection, and security monitoring within the lab environment.
<p align="center"> 
<img src="https://i.imgur.com/64gGuNa.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<img src="https://i.imgur.com/58SdSIl.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<p align="left"> 
Created a Data Collection Rule (DCR) to define log sources and destinations for the Windows Security Events (AMA) connector. Configured the rule to collect Security event logs from the Azure virtual machine CORP-NETCT-EAST-1 and route them to the LOGA-SOC-LAB-100 Log Analytics Workspace for centralized analysis and monitoring.
<p align="center"> 
<img src="https://i.imgur.com/1rVKsu7.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<p align="left"> 
Installed the Azure Monitor Windows Agent (AMA) extension on VM CORP-NETCT-EAST-1 and configured a Data Collection Rule (DCR) to collect Windows Security Event logs via AMA, forwarding them to the LOGA-SOC-LAB-100 workspace for centralized security monitoring in Microsoft Sentinel.
<p align="center"> 
<img src="https://i.imgur.com/LEDxhZi.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />


<h2>Captured intruder attempt logs:</h2>
<p align="left"> 
Azure Log Analytics workspace named LOGA-SOC-LAB-100 in the Logs view. A Kusto Query Language (KQL) query SecurityEvent has been executed to retrieve Windows Security event logs. The results table displays multiple entries of Event ID 4625, which indicates failed logon attempts -

- <b>Account: The username that attempted to log in (e.g., \SICHE, \ALI, \BLANCA, etc.).</b>

- <b>Computer: All events are from the VM CORP-CTNET-EAST.</b>

- <b>EventSourceName: Microsoft-Windows-Security-Auditing.</b>

- <b>Channel: Security.</b>

- <b>EventID: 4625 for all entries.</b>

- <b>Activity: Text description, e.g., “4625 – An account failed to log on.”</b>

- <b>AuthenticationPackageName: NTLM, showing the type of authentication attempt.</b>

- <b>FailureReason: Shows the failure code %2313.</b>

- <b>IpAddress / IpPort: Source IP addresses and port numbers from which the failed logins originated.</b>

- <b>LogonProcessName: NtLmSsp, indicating the authentication process used.</b>
<br />
<p align="left"> 
The logs show multiple failed logon attempts (intruder attacks) across various usernames, likely generated for testing failed login capture in Event Viewer. The logs are successfully collected via the AMA (Azure Monitor Agent) and sent to the LOGA-SOC-LAB-100 workspace. This confirms the Data Collection Rule (DCR) and Windows Security Events connector are functioning correctly.
<p align="center">
<img src="https://i.imgur.com/d3bZknv.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<p align="left"> 
The screenshot shows a query executed in the Azure Log Analytics Workspace LOGA-SOC-LAB-100, filtering Windows Security Events for the account \SICHE. The results display a failed logon attempt (Event ID 4625) on the virtual machine CORP-CTNET-EAST, originating from IP address 92.63.197.23 and authenticated through NTLM. This event indicates a possible unauthorized or intruder login attempt, commonly associated with brute-force or credential-guessing activity detected during the SOC lab analysis.
  (KQL)
  - SecurityEvent
| where Account == "\\SICHE"

<p align="center">
<img src="https://i.imgur.com/NWN6AVV.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<p align="left"> 
Conducted an IP geolocation lookup using IPlocation.net; results indicate the attacker originated from an approximate location associated with IP 92.63.197.23 (geolocation is approximate and should be corroborated with additional evidence).
<p align="center">
<img src="https://i.imgur.com/diqqjqs.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<p align="left"> 
This KQL query - 
SecurityEvent
| where EventID == 4625
| project TimeGenerated, Account, Computer, EventID, Activity, IpAddress
<br />
<br />
Filters Windows Security Events for Event ID 4625, which indicates failed login attempts. It then displays key details such as time generated, user account, host computer, event ID, activity description, and source IP address, helping identify potential intruder or brute-force attacks in Azure Sentinel.
<p align="center">
<img src="https://i.imgur.com/Z7oHzAy.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<p align="left"> 
A GeoIP watchlist was created to track and correlate login attempts or alerts based on geographic locations, helping identify suspicious or foreign IP addresses that may indicate intruder activity.
<br />
<p align="center">
<img src="https://i.imgur.com/C0NU4mO.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<p align="left">
This KQL query - 
let GeoIPDB_FULL = _GetWatchlist("geoip");
let WindowsEvents = SecurityEvent
    | where IpAddress == <attacker IP address>
    | where EventID == 4625
    | order by TimeGenerated desc
    | evaluate ipv4_lookup(GeoIPDB_FULL, IpAddress, network);
WindowsEvents
    | project TimeGenerated, Computer, Attackerip = IpAddress, cityname, countryname, latitude, longitude
<br />
<br />
Filtering Windows Security Events for failed logins (Event ID 4625) from specific IP addresses, this project enriches the events with geographic data using a GeoIP watchlist. It showcases the ability to detect potential intrusions, trace attacker locations, and provide actionable insights through KQL query analysis.
<p align="center">
<img src="https://i.imgur.com/C0gO6kV.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<p align="left">
Created a Sentinel workbook and added a Windows VM attack map that visualizes security events, aligning with logged failed login attempts. The workbook highlights detection points, traces attacker locations using GeoIP data, and provides actionable insights for threat analysis.
<p align="center">
<img src="https://i.imgur.com/OSbpT6y.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<img src="https://i.imgur.com/D7RZ2ZV.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>
<br />
<br />
<img src="https://i.imgur.com/tDHcx9a.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>



<h2>Summary</h2>








